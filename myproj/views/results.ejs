<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Netflix Wrapped - Results</title>
    <link rel="stylesheet" type="text/css" href="/css/styles.css">
</head>
<body>
    <div class="header">
        <h1><span class="netflix">Netflix</span> <span class="wrapped">Wrapped</span></h1>
    </div>
    <!-- Search Box -->
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="Search...">
        <button id="searchButton" class="button">Search</button>
    </div>
    <div class="container">
        <div id="displayInfo" class="data-container"></div>
        <div class="data-container runtime-container" style="overflow: hidden;">
            <h1 class="runtime-heading"><span class="netflix">Runtime</span></h1>
            <div class="chart-container">
                <canvas id="runtimeChart"></canvas>
            </div>
            <div id="runtimeData" class="runtime-table"></div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        $(document).ready(function() {
            $.ajax({
                url: '/api/runtime',
                method: 'GET',
                success: function(data) {
                    let content = '<table class="data-table"><tr><th>Year</th><th>Type</th><th>Total Time (min)</th></tr>';
                    data.forEach(function(item) {
                        content += `<tr><td>${item.year}</td><td>${item.titleType}</td><td>${item.totaltime}</td></tr>`;
                    });
                    content += '</table>';
                    $('#runtimeData').html(content);
                    
                    // Prepare data for the chart
                    var types = data.map(item => item.titleType);
                    var totalTimes = data.map(item => item.totaltime);
                    
                    // Create the chart
                    var ctx = document.getElementById('runtimeChart').getContext('2d');
                    var myChart = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: types,
                            datasets: [{
                                label: 'Total Time (min)',
                                data: totalTimes,
                                backgroundColor: [
                                    'rgba(255, 99, 132, 0.5)',
                                    'rgba(54, 162, 235, 0.5)',
                                    'rgba(255, 206, 86, 0.5)',
                                    'rgba(75, 192, 192, 0.5)',
                                    'rgba(153, 102, 255, 0.5)',
                                    'rgba(255, 159, 64, 0.5)'
                                ],
                                borderColor: [
                                    'rgba(255, 99, 132, 1)',
                                    'rgba(54, 162, 235, 1)',
                                    'rgba(255, 206, 86, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(153, 102, 255, 1)',
                                    'rgba(255, 159, 64, 1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Runtime by Type'
                                },
                                legend: {
                                    display: true,
                                    position: 'right'
                                }
                            }
                        }
                    });
                },
                error: function() {
                    $('#runtimeData').html('<p>No data found for runtime.</p>');
                }
            });

            // Function to search and filter display items
            function searchDisplay(searchText) {
                $.ajax({
                    url: '/api/display',
                    method: 'GET',
                    success: function(data) {
                        let filteredData = data.filter(function(item) {
                            // Convert search text and item's title to lowercase for case-insensitive search
                            return item.primaryTitle.toLowerCase().includes(searchText.toLowerCase());
                        });

                        let content = '<table class="data-table"><tr><th>ID</th><th>Title</th><th>Date</th><th>Season</th><th>Episode</th><th>Title Type</th><th>Actions</th></tr>';
                        filteredData.forEach(function(item) {
                            content += `<tr id="display_${item.id}"><td>${item.id}</td><td>${item.primaryTitle}</td><td>${item.Date}</td><td>${item.Season}</td><td>${item.Episode}</td><td>${item.titleType}</td><td><button class="button">Modify</button> <button class="button">Delete</button></td></tr>`;
                        });
                        content += '</table>';
                        $('#displayInfo').html(content);
                    },
                    error: function() {
                        $('#displayInfo').html('<p>Error fetching display info.</p>');
                    }
                });
            }

            // Search button click event
            $('#searchButton').click(function() {
                var searchText = $('#searchInput').val();
                searchDisplay(searchText);
            });

            // Load display info automatically
            $.ajax({
                url: '/api/display',
                method: 'GET',
                success: function(data) {
                    let content = '<table class="data-table"><tr><th>ID</th><th>Title</th><th>Date</th><th>Season</th><th>Episode</th><th>Title Type</th><th>Actions</th></tr>';
                    data.forEach(function(item) {
                        content += `<tr id="display_${item.id}"><td>${item.id}</td><td>${item.primaryTitle}</td><td>${item.Date}</td><td>${item.Season}</td><td>${item.Episode}</td><td>${item.titleType}</td><td><button class="button">Modify</button> <button class="button">Delete</button></td></tr>`;
                    });
                    content += '</table>';
                    $('#displayInfo').html(content);
                }
            });
        });
    </script>
</body>
</html>





<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Netflix Wrapped - Results</title>
    <link rel="stylesheet" type="text/css" href="/css/styles.css">
</head>
<body>
    <div class="header">
        <h1><span class="netflix">Netflix</span> <span class="wrapped">Wrapped</span></h1>
    </div>
    <!-- Search Box -->
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="Search...">
        <button id="searchButton" class="button">Search</button>
    </div>
    <div class="container">
        <div id="displayInfo" class="data-container"></div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            // Function to load display info
            function loadDisplayInfo() {
                $.ajax({
                    url: '/api/display',
                    method: 'GET',
                    success: function(data) {
                        let content = '<table class="data-table"><tr><th>ID</th><th>Title</th><th>Runtime (minutes)</th><th>Season</th><th>Date</th><th>Title Type</th><th>Actions</th></tr>';
                        data.forEach(function(item) {
                            content += `<tr id="display_${item.id}"><td>${item.id}</td><td>${item.primaryTitle}</td><td>${item.runtimeMinutes}</td><td>${item.Season}</td><td>${item.Date}</td><td>${item.titleType}</td><td><button class="button modify-button" data-id="${item.id}" data-primaryTitle="${item.primaryTitle}" data-runtimeMinutes="${item.runtimeMinutes}" data-Season="${item.Season}" data-Date="${item.Date}" data-titleType="${item.titleType}">Modify</button> <button class="button delete-button" data-id="${item.id}">Delete</button></td></tr>`;
                        });
                        content += '</table>';
                        $('#displayInfo').html(content);
                    },
                    error: function() {
                        $('#displayInfo').html('<p>Error fetching display info.</p>');
                    }
                });
            }
            loadDisplayInfo();

            // Modify Button Click Event
            $(document).on('click', '.modify-button', function() {
                var displayId = $(this).data('id');
                var displayRow = $('#display_' + displayId);
                var primaryTitle = $(this).data('primarytitle');
                var runtimeMinutes = parseInt($(this).data('runtimeminutes')); // Convert to integer
                var Season = $(this).data('season');
                var Date = $(this).data('date');
                var titleType = $(this).data('titletype');

                var titleInput = $('<input type="text" class="edit-title" value="' + primaryTitle + '">');
                var runtimeInput = $('<input type="number" class="edit-runtime" value="' + runtimeMinutes + '">'); // Change input type to number
                var seasonInput = $('<input type="text" class="edit-season" value="' + Season + '">');
                var dateInput = $('<input type="text" class="edit-date" value="' + Date + '">');
                var titleTypeInput = $('<input type="text" class="edit-titleType" value="' + titleType + '">');
                
                displayRow.find('td:eq(1)').html(titleInput);
                displayRow.find('td:eq(2)').html(runtimeInput);
                displayRow.find('td:eq(3)').html(seasonInput);
                displayRow.find('td:eq(4)').html(dateInput);
                displayRow.find('td:eq(5)').html(titleTypeInput);
                
                var modifyButton = $('<button class="button update-button">Update</button>');
                displayRow.find('td:eq(6)').html(modifyButton);
            });

            // Update Button Click Event
            $(document).on('click', '.update-button', function() {
                var displayId = $(this).closest('tr').attr('id').split('_')[1];
                var displayRow = $(this).closest('tr');
                var primaryTitle = displayRow.find('.edit-title').val();
                var runtimeMinutes = parseInt(displayRow.find('.edit-runtime').val()); // Convert to integer
                var Season = displayRow.find('.edit-season').val();
                var Date = displayRow.find('.edit-date').val();
                var titleType = displayRow.find('.edit-titleType').val();

                $.ajax({
                    url: '/api/display/update/' + displayId,
                    method: 'POST',
                    data: JSON.stringify({ primaryTitle: primaryTitle, runtimeMinutes: runtimeMinutes, Season: Season, Date: Date, titleType: titleType }),
                    contentType: 'application/json',
                    success: function(response) {
                        loadDisplayInfo();
                        alert('Display info updated successfully');
                    },
                    error: function() {
                        alert('Error updating display info');
                    }
                });
            });

            // Delete Button Click Event
            $(document).on('click', '.delete-button', function() {
                var displayId = $(this).data('id');
                if (confirm('Are you sure you want to delete this display info?')) {
                    $.ajax({
                        url: '/api/display/delete/' + displayId,
                        method: 'POST',
                        success: function(response) {
                            $('#display_' + displayId).remove();
                            alert('Display info deleted successfully');
                        },
                        error: function() {
                            alert('Error deleting display info');
                        }
                    });
                }
            });

            // Search Button Click Event
            $('#searchButton').click(function() {
                var searchText = $('#searchInput').val();
                searchDisplay(searchText);
            });

            // Function to search and filter display items
            function searchDisplay(searchText) {
                $.ajax({
                    url: '/api/display/search',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ searchText: searchText }),
                    success: function(data) {
                        renderDisplayInfo(data);
                    },
                    error: function() {
                        $('#displayInfo').html('<p>Error fetching filtered display info.</p>');
                    }
                });
            }

            // Function to render display info
            function renderDisplayInfo(data) {
                let content = '<table class="data-table"><tr><th>ID</th><th>Title</th><th>Runtime (minutes)</th><th>Season</th><th>Date</th><th>Title Type</th><th>Actions</th></tr>';
                data.forEach(function(item) {
                    content += `<tr id="display_${item.id}"><td>${item.id}</td><td>${item.primaryTitle}</td><td>${item.runtimeMinutes}</td><td>${item.Season}</td><td>${item.Date}</td><td>${item.titleType}</td><td><button class="button modify-button" data-id="${item.id}" data-primaryTitle="${item.primaryTitle}" data-runtimeMinutes="${item.runtimeMinutes}" data-Season="${item.Season}" data-Date="${item.Date}" data-titleType="${item.titleType}">Modify</button> <button class="button delete-button" data-id="${item.id}">Delete</button></td></tr>`;
                });
                content += '</table>';
                $('#displayInfo').html(content);
            }

            
        });
    </script>
</body>
</html>
